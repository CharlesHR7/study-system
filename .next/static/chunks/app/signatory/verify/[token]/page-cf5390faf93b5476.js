(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7101],{616:(e,t,n)=>{Promise.resolve().then(n.bind(n,2454))},2454:(e,t,n)=>{"use strict";n.d(t,{default:()=>a});var i=n(5155),r=n(2115);function s(e){let{initialSvg:t,onSaveSvg:n,height:s=180}=e,a=(0,r.useRef)(null),l=(0,r.useRef)(null),[o,c]=(0,r.useState)([]),[d,u]=(0,r.useState)([]),[h,x]=(0,r.useState)(!1),[g,v]=(0,r.useState)({w:700,h:s});(0,r.useEffect)(()=>{let e=()=>{var e,t;v({w:null!=(t=null==(e=l.current)?void 0:e.clientWidth)?t:700,h:s})};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[s]);let f=(e,t)=>{let n=a.current;if(!n)return;let i=n.getContext("2d");if(!i)return;i.clearRect(0,0,n.width,n.height),i.fillStyle="#f8fafc",i.fillRect(0,0,n.width,n.height),i.strokeStyle="#111827",i.lineWidth=1,i.strokeRect(.5,.5,n.width-1,n.height-1),i.strokeStyle="#111827",i.lineWidth=2.2,i.lineJoin="round",i.lineCap="round";let r=e=>{if(!(e.length<2)){i.beginPath(),i.moveTo(e[0].x,e[0].y);for(let t=1;t<e.length;t++)i.lineTo(e[t].x,e[t].y);i.stroke()}};e.forEach(r),r(t)};(0,r.useEffect)(()=>{let e=a.current;if(!e)return;e.width=g.w*devicePixelRatio,e.height=g.h*devicePixelRatio,e.style.width="".concat(g.w,"px"),e.style.height="".concat(g.h,"px");let t=e.getContext("2d");t&&(t.scale(devicePixelRatio,devicePixelRatio),f(o,d))},[g.w,g.h]),(0,r.useEffect)(()=>{f(o,d)},[o,d]);let m=e=>{let t=a.current.getBoundingClientRect();return{x:e.clientX-t.left,y:e.clientY-t.top}},p=()=>{h&&(x(!1),c(e=>[...e,d]),u([]))},w=(0,r.useMemo)(()=>{let e=g.w,t=g.h,n=function(e){let t=[];for(let n of e)if(!(n.length<2)){t.push("M ".concat(n[0].x.toFixed(2)," ").concat(n[0].y.toFixed(2)));for(let e=1;e<n.length;e++){let i=n[e];t.push("L ".concat(i.x.toFixed(2)," ").concat(i.y.toFixed(2)))}}return t.join(" ")}(o);return'<?xml version="1.0" encoding="UTF-8"?>\n<svg xmlns="http://www.w3.org/2000/svg" width="'.concat(e,'" height="').concat(t,'" viewBox="0 0 ').concat(e," ").concat(t,'">\n  <path d="').concat(n,'" fill="none" stroke="#111827" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round" />\n</svg>')},[o,g.w,g.h]);return(0,i.jsxs)("div",{ref:l,className:"w-full",children:[(0,i.jsx)("div",{className:"text-[12px] text-gray-700 mb-2",children:"Draw your signature below (use finger/stylus)."}),(0,i.jsx)("canvas",{ref:a,className:"w-full touch-none",onPointerDown:e=>{e.preventDefault(),e.target.setPointerCapture(e.pointerId),x(!0),u([m(e.nativeEvent)])},onPointerMove:e=>{h&&u(t=>[...t,m(e.nativeEvent)])},onPointerUp:p,onPointerCancel:p}),(0,i.jsxs)("div",{className:"mt-2 flex gap-2",children:[(0,i.jsx)("button",{type:"button",onClick:()=>{c([]),u([])},className:"px-3 py-1 rounded border border-gray-300 bg-white hover:bg-gray-100 text-[12px]",children:"Clear"}),(0,i.jsx)("button",{type:"button",onClick:()=>n(w),className:"px-3 py-1 rounded border border-gray-800 bg-gray-900 text-white hover:bg-black text-[12px]",children:"Save signature"})]}),t?(0,i.jsxs)("div",{className:"mt-3",children:[(0,i.jsx)("div",{className:"text-[11px] text-gray-600 mb-1",children:"Current saved signature (preview):"}),(0,i.jsx)("img",{alt:"",className:"border border-gray-300 bg-white",src:"data:image/svg+xml;utf8,".concat(encodeURIComponent(t))})]}):null]})}function a(e){let{rawToken:t,signatory:n}=e,[a]=(0,r.useState)(n.name),[l]=(0,r.useState)(n.email),[o]=(0,r.useState)(n.licenceOrAuthNo),[c]=(0,r.useState)(n.initials),[d,u]=(0,r.useState)(n.signatureSvg),[h,x]=(0,r.useState)(""),g=async e=>{x("Saving...");let n=await fetch("/api/signatory/verify",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:t,signatureSvg:e})});if(!n.ok){var i;let e=await n.json().catch(()=>({}));x(null!=(i=null==e?void 0:e.error)?i:"Error saving");return}u(e),x("Saved. Signatory verified ✅")};return(0,i.jsxs)("div",{className:"p-6 max-w-xl mx-auto",children:[(0,i.jsx)("div",{className:"text-[22px] font-bold mb-2",children:"Confirm Signatory Profile"}),(0,i.jsx)("div",{className:"text-gray-700 text-[13px] mb-4",children:"Please review your details and draw your signature. This signature will be used for printing and verification."}),(0,i.jsxs)("div",{className:"border border-gray-200 rounded p-3 bg-white mb-4 text-[13px]",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("span",{className:"font-semibold",children:"Name:"})," ",a]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("span",{className:"font-semibold",children:"Email:"})," ",l]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("span",{className:"font-semibold",children:"Licence/Authority #:"})," ",o||"—"]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("span",{className:"font-semibold",children:"Initials:"})," ",c||"—"]})]}),(0,i.jsx)(s,{initialSvg:d,onSaveSvg:g}),h?(0,i.jsx)("div",{className:"mt-3 text-[12px] text-gray-700",children:h}):null]})}}},e=>{e.O(0,[8441,1255,7358],()=>e(e.s=616)),_N_E=e.O()}]);