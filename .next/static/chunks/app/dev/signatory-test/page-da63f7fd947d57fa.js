(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6420],{3127:(e,a,r)=>{"use strict";r.r(a),r.d(a,{default:()=>o});var s=r(5155),t=r(2115);let l="ameone_dev_logbookId";function o(){let[e,a]=(0,t.useState)(""),[r,o]=(0,t.useState)(""),[i,d]=(0,t.useState)(!1),[n,c]=(0,t.useState)("John Doe"),[u,g]=(0,t.useState)("john@example.com"),[b,m]=(0,t.useState)("TC-123456"),[x,h]=(0,t.useState)("JD"),[y,p]=(0,t.useState)([]),[v,j]=(0,t.useState)(""),[f,N]=(0,t.useState)(12),[k,w]=(0,t.useState)("05"),[S,C]=(0,t.useState)("Inspection following lightning strike");(0,t.useEffect)(()=>{let e=localStorage.getItem(l);e&&a(e)},[]),(0,t.useEffect)(()=>{e&&localStorage.setItem(l,e)},[e]);let E=(0,t.useMemo)(()=>!!e,[e]);async function I(){var e,r;d(!0),o("");try{let r=await fetch("/api/logbook/create",{method:"POST"}),s=await r.json();if(!r.ok)throw Error(null!=(e=null==s?void 0:s.error)?e:"Failed");a(s.logbookId),o("✅ Logbook created: ".concat(s.logbookId))}catch(e){o("❌ ".concat(null!=(r=e.message)?r:"Error"))}finally{d(!1)}}async function T(){var a,r;if(e){d(!0),o("");try{let r=await fetch("/api/signatory/create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({logbookId:e,name:n,email:u,licenceOrAuthNo:b,initials:x})}),s=await r.json();if(!r.ok)throw Error(null!=(a=null==s?void 0:s.error)?a:"Failed");let t=s.signatory;p(e=>[t,...e]),j(t.id),o("✅ Signatory created: ".concat(t.name," (").concat(t.status,")"))}catch(e){o("❌ ".concat(null!=(r=e.message)?r:"Error"))}finally{d(!1)}}}async function D(){var e,a;if(v){d(!0),o("");try{let a=await fetch("/api/signatory/".concat(v,"/send-verify"),{method:"POST"}),r=await a.json();if(!a.ok)throw Error(null!=(e=null==r?void 0:r.error)?e:"Failed");o("✅ Verify email (DEV) generated. Check your terminal for the link.")}catch(e){o("❌ ".concat(null!=(a=e.message)?a:"Error"))}finally{d(!1)}}}async function V(){var a,r;if(v&&e){d(!0),o("");try{let r=await fetch("/api/sign-request/create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({logbookId:e,signatoryId:v,tasks:[{rowIndex:Number(f),ata:k,taskText:S}]})}),s=await r.json();if(!r.ok)throw Error(null!=(a=null==s?void 0:s.error)?a:"Failed");o("✅ Signature request (DEV) generated. Check your terminal for the link.")}catch(e){o("❌ ".concat(null!=(r=e.message)?r:"Error"))}finally{d(!1)}}}return(0,s.jsxs)("div",{className:"p-6 max-w-3xl mx-auto",children:[(0,s.jsx)("div",{className:"text-2xl font-bold mb-1",children:"DEV — Signatory + Email Flow"}),(0,s.jsx)("div",{className:"text-sm text-gray-700 mb-4",children:"This page is just to test the DB + token links end-to-end."}),(0,s.jsxs)("div",{className:"border border-gray-200 rounded p-4 bg-white mb-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,s.jsxs)("div",{className:"text-sm",children:[(0,s.jsx)("div",{className:"font-semibold",children:"Current logbookId"}),(0,s.jsx)("div",{className:"text-gray-700 break-all",children:e||"— (none yet)"})]}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)("button",{onClick:I,disabled:i,className:"px-3 py-2 rounded border border-gray-800 bg-gray-900 text-white hover:bg-black disabled:opacity-50",children:"Create Logbook"}),(0,s.jsx)("button",{onClick:function(){localStorage.removeItem(l),a(""),p([]),j(""),o("✅ Local dev state cleared.")},disabled:i,className:"px-3 py-2 rounded border border-gray-300 bg-white hover:bg-gray-100 disabled:opacity-50",children:"Reset"})]})]}),(0,s.jsx)("div",{className:"mt-3 text-xs text-gray-600",children:"Create Logbook = creates a DB “container” (Logbook) that owns signatories, signature requests and audit events."})]}),(0,s.jsxs)("div",{className:"grid md:grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{className:"border border-gray-200 rounded p-4 bg-white",children:[(0,s.jsx)("div",{className:"font-semibold mb-2",children:"1) Add Signatory"}),(0,s.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,s.jsxs)("label",{className:"block",children:[(0,s.jsx)("div",{className:"text-gray-700",children:"Name"}),(0,s.jsx)("input",{className:"w-full border border-gray-300 rounded px-2 py-1",value:n,onChange:e=>c(e.target.value)})]}),(0,s.jsxs)("label",{className:"block",children:[(0,s.jsx)("div",{className:"text-gray-700",children:"Email"}),(0,s.jsx)("input",{className:"w-full border border-gray-300 rounded px-2 py-1",value:u,onChange:e=>g(e.target.value)})]}),(0,s.jsxs)("label",{className:"block",children:[(0,s.jsx)("div",{className:"text-gray-700",children:"Licence/Authority #"}),(0,s.jsx)("input",{className:"w-full border border-gray-300 rounded px-2 py-1",value:b,onChange:e=>m(e.target.value)})]}),(0,s.jsxs)("label",{className:"block",children:[(0,s.jsx)("div",{className:"text-gray-700",children:"Initials"}),(0,s.jsx)("input",{className:"w-full border border-gray-300 rounded px-2 py-1",value:x,onChange:e=>h(e.target.value)})]}),(0,s.jsx)("button",{onClick:T,disabled:i||!E,className:"w-full mt-1 px-3 py-2 rounded border border-gray-300 bg-white hover:bg-gray-100 disabled:opacity-50",children:"Add Signatory"}),!E&&(0,s.jsx)("div",{className:"text-xs text-red-600",children:"Create Logbook first."})]})]}),(0,s.jsxs)("div",{className:"border border-gray-200 rounded p-4 bg-white",children:[(0,s.jsx)("div",{className:"font-semibold mb-2",children:"2) Verify + Request Signature"}),(0,s.jsxs)("label",{className:"block text-sm mb-2",children:[(0,s.jsx)("div",{className:"text-gray-700",children:"Select signatory"}),(0,s.jsxs)("select",{className:"w-full border border-gray-300 rounded px-2 py-2",value:v,onChange:e=>j(e.target.value),children:[(0,s.jsx)("option",{value:"",children:"— choose —"}),y.map(e=>(0,s.jsxs)("option",{value:e.id,children:[e.name," (",e.status,")"]},e.id))]})]}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)("button",{onClick:D,disabled:i||!v,className:"flex-1 px-3 py-2 rounded border border-gray-300 bg-white hover:bg-gray-100 disabled:opacity-50",children:"Send Verify (DEV)"}),(0,s.jsx)("button",{onClick:V,disabled:i||!v,className:"flex-1 px-3 py-2 rounded border border-gray-800 bg-gray-900 text-white hover:bg-black disabled:opacity-50",children:"Request Signature (DEV)"})]}),(0,s.jsxs)("div",{className:"mt-3 border-t border-gray-100 pt-3",children:[(0,s.jsx)("div",{className:"font-semibold text-sm mb-2",children:"Task sample"}),(0,s.jsxs)("div",{className:"grid grid-cols-3 gap-2 text-sm",children:[(0,s.jsxs)("label",{className:"block",children:[(0,s.jsx)("div",{className:"text-gray-700",children:"rowIndex"}),(0,s.jsx)("input",{type:"number",className:"w-full border border-gray-300 rounded px-2 py-1",value:f,onChange:e=>N(Number(e.target.value))})]}),(0,s.jsxs)("label",{className:"block",children:[(0,s.jsx)("div",{className:"text-gray-700",children:"ATA"}),(0,s.jsx)("input",{className:"w-full border border-gray-300 rounded px-2 py-1",value:k,onChange:e=>w(e.target.value)})]}),(0,s.jsxs)("label",{className:"block col-span-3",children:[(0,s.jsx)("div",{className:"text-gray-700",children:"Task text"}),(0,s.jsx)("input",{className:"w-full border border-gray-300 rounded px-2 py-1",value:S,onChange:e=>C(e.target.value)})]})]}),(0,s.jsx)("div",{className:"text-xs text-gray-600 mt-2",children:"After verification, the signatory will draw a signature on mobile. The signature request link also appears in the terminal (DEV mode)."})]})]})]}),r?(0,s.jsx)("div",{className:"mt-4 p-3 border border-gray-200 rounded bg-white text-sm",children:r}):null]})}},8585:(e,a,r)=>{Promise.resolve().then(r.bind(r,3127))}},e=>{e.O(0,[8441,1255,7358],()=>e(e.s=8585)),_N_E=e.O()}]);