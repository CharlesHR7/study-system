(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1452],{3779:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>c});var r=n(5155),i=n(2115);function o(e,t,n){let r=e.filter(e=>e.length>1).map(e=>'<path d="'.concat(function(e){if(!e.length)return"";let t=[];t.push("M ".concat(e[0].x.toFixed(1)," ").concat(e[0].y.toFixed(1)));for(let n=1;n<e.length-1;n++){let r=e[n],i=e[n+1],o=(r.x+i.x)/2,s=(r.y+i.y)/2;t.push("Q ".concat(r.x.toFixed(1)," ").concat(r.y.toFixed(1)," ").concat(o.toFixed(1)," ").concat(s.toFixed(1)))}let n=e[e.length-1];return t.push("L ".concat(n.x.toFixed(1)," ").concat(n.y.toFixed(1))),t.join(" ")}(e),'" fill="none" stroke="#111827" stroke-width="2.6" stroke-linecap="round" stroke-linejoin="round" />')).join("");return'<svg xmlns="http://www.w3.org/2000/svg" width="'.concat(t,'" height="').concat(n,'" viewBox="0 0 ').concat(t," ").concat(n,'">').concat(r,"</svg>")}function s(e,t){let n=t.getBoundingClientRect();return{x:Math.max(0,Math.min(n.width,e.clientX-n.left)),y:Math.max(0,Math.min(n.height,e.clientY-n.top))}}function c(e){let{params:t}=e,n=t.token,c=(0,i.useRef)(null),a=(0,i.useRef)([]),l=(0,i.useRef)([]),u=(0,i.useRef)(!1),[,d]=(0,i.useState)(0),[h,x]=(0,i.useState)(!1),[p,f]=(0,i.useState)(!1),[m,g]=(0,i.useState)(""),v=(0,i.useMemo)(()=>{let e=[...a.current];return l.current.length>1&&e.push(l.current),o(e,520,180)},[d,h,p]);(0,i.useEffect)(()=>{let e=c.current;if(!e)return;let t=t=>{t.preventDefault(),u.current=!0,e.setPointerCapture(t.pointerId),l.current=[s(t,e)],d(e=>e+1)},n=t=>{u.current&&(l.current.push(s(t,e)),d(e=>e+1))},r=()=>{u.current&&(u.current=!1,l.current.length>1&&a.current.push(l.current),l.current=[],d(e=>e+1))};return e.addEventListener("pointerdown",t),e.addEventListener("pointermove",n),e.addEventListener("pointerup",r),e.addEventListener("pointercancel",r),()=>{e.removeEventListener("pointerdown",t),e.removeEventListener("pointermove",n),e.removeEventListener("pointerup",r),e.removeEventListener("pointercancel",r)}},[]);let y=async()=>{x(!0),g("");try{let e=o(a.current,520,180),t=await fetch("/api/signatories/verify",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:n,signatureSvg:e})}),r=await t.json();if(!t.ok)throw Error((null==r?void 0:r.error)||"Verification failed");f(!0)}catch(e){g((null==e?void 0:e.message)||"Error")}finally{x(!1)}};return(0,r.jsx)("div",{className:"min-h-screen bg-white p-4 flex justify-center",children:(0,r.jsxs)("div",{className:"w-full max-w-lg",children:[(0,r.jsx)("h1",{className:"text-xl font-semibold",children:"Signatory verification"}),(0,r.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:"Draw your signature below and confirm. Use your finger on your phone."}),(0,r.jsx)("div",{ref:c,className:"mt-4 border border-gray-300 rounded bg-white",style:{height:180,touchAction:"none"},children:(0,r.jsx)("div",{className:"w-full h-full overflow-hidden",dangerouslySetInnerHTML:{__html:v}})}),m&&(0,r.jsx)("div",{className:"mt-3 text-sm text-red-600",children:m}),p&&(0,r.jsx)("div",{className:"mt-3 text-sm text-green-700",children:"✅ Verified. You can close this page."}),(0,r.jsxs)("div",{className:"mt-4 flex gap-2",children:[(0,r.jsx)("button",{type:"button",className:"px-3 py-2 rounded border border-gray-300",onClick:()=>{a.current=[],l.current=[],d(e=>e+1)},disabled:h||p,children:"Clear"}),(0,r.jsx)("button",{type:"button",className:"px-3 py-2 rounded border border-gray-800 bg-gray-900 text-white",onClick:y,disabled:h||p,children:h?"Saving…":"Confirm signature"})]})]})})}},8735:(e,t,n)=>{Promise.resolve().then(n.bind(n,3779))}},e=>{e.O(0,[8441,1255,7358],()=>e(e.s=8735)),_N_E=e.O()}]);